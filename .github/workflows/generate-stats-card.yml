# 保存为 .github/workflows/generate-stats-card.yml
# 触发：每天一次 & 手动触发
on:
  schedule:
    - cron: '0 0 * * *'  # 每天 UTC 00:00，可按需修改
  workflow_dispatch: {}

jobs:
  build-and-generate:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Generate GitHub stats card
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          GITHUB_USER: github653224
        run: |
          python3 scripts/generate_stats_card.py --user "$GITHUB_USER" --out assets/github_stats.png

      - name: Commit and push generated image (if changed)
        uses: stefanzweifel/git-auto-commit-action@v4
        with:
          commit_message: "chore: update github stats card"
          file_pattern: assets/github_stats.png
          branch: main
          author_name: github-actions
          author_email: github-actions@users.noreply.github.com
